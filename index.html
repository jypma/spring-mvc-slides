<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Spring MVC - Introduction</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="reveal.js-2.6.0/css/reveal.css">
		<link rel="stylesheet" href="reveal.js-2.6.0/css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="reveal.js-2.6.0/lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="reveal.js-2.6.0/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="reveal.js-2.6.0/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Spring MVC</h1>
					<h3>Introduction</h3>
					
					<p style="margin-top: 4em">
						<small>Jan Ypma<br/>
						<a href="mailto:ypma@lundogbendsen.dk">
							ypma@lundogbendsen.dk
						</a></small>
					</p>
					
					<p style="margin-top: 2em; margin-right: 3em; text-align: right">
					  <a href="http://www.lundogbendsen.dk">
					    <img width="300" height="65" src="lb.png" alt="L&amp;B Logo"  style="background-color: white; border: 3px solid white; -webkit-transform: rotate(-10deg); -moz-transform: rotate(-10deg);"/>
            </a>
					</p>
          
          <p style="text-align: left; font-size: 30%">
            <a href="index.html?print-pdf">Print / PDF</a>
          </p>
				</section>

				<section>
					<h2>A quick refresher</h2>
					<p>Remind us again about:</p>
					<ul>
					  <li>Auto-wiring (<code>@Autowire</code>)</li>
					  <li>Aspect-Oriented Programming (AOP)</li>
					  <li>Classpath scanning</li>
					  <li>JAXB (XML binding)</li>
					</ul>
				</section>

				<section>
					<h2>MVC Definitions</h2>
					<ul>
					  <li>
							<em>Model</em><br/>Structured information used / created on a page		
						</li>
						<li>
						  <em>View</em><br/>User interface for interacting with the model
						</li>
						<li>
						  <em>Controller</em><br/>Logic binding model and view together
						</li>
					</ul>
				</section>
				
				<section>
					<h2>Spring MVC Architecture</h2>
					<ul>
					  <li><em>Model</em><br/>Plain old Java classes (POJO)<br/>Per request or session</li>
					  <li><em>View</em><br/>Pluggable, typically JSP pages, Freemarker or Velocity</li>
					  <li><em>Controller</em><br/>Classpath-scanned <code>@Component</code>-annotated classes<br/>Singletons</li>
					</ul>
				</section>

				<section>
					<h2>An example model class</h2>
					<p><em>Immutable</em> (see advanced section)</p>
					<pre><code data-trim contenteditable>					
@XmlRootElement(name = "TodoItem")
@XmlAccessorType(XmlAccessType.NONE)
public class TodoItem {
    public static TodoItem create(String title) {
        return new TodoItem(UUID.randomUUID(), title);
    }
    
    @XmlElement(name = "ID") private UUID id;
    @NotBlank @XmlElement(name = "Title") private String title;
    
    public String getTitle() { return title; }
    
    public UUID getId() { return id; }
    
    private TodoItem(UUID id, String title) { ... }
}
					</code></pre>
				</section>

				<section>
					<h2>An example JSP view</h2>
					<p>Creating/editing a todo item 
					<pre><code data-trim  contenteditable>
&lt;h3&gt;Edit a todo item&lt;/h3&gt;
&lt;form:form id="form" method="post" modelAttribute="item"&gt;
  &lt;form:hidden path="id"/&gt;

  &lt;div&gt;
    &lt;form:label path="title"&gt;
      &lt;spring:message code="item.title" /&gt;
    &lt;/form:label&gt;
    &lt;form:input path="title" placeholder="What needs to be done?" /&gt;
    &lt;form:errors path="title" /&gt;
  &lt;/div&gt;

  &lt;div&gt;&lt;button type="submit" class="btn"&gt;Save&lt;/button&gt;&lt;/div&gt;
&lt;/form:form&gt;

</code></pre>
				</section>

        <section>
          <h2>Supported view technologies</h2>
          <ul>
            <li>
              <em>JSP</em> (with JSTL and Spring MVC tag libraries)<br/>
              Popular and documented. Many initial quirks resolved in latest JSP versions.
              Usually combined with 
              <a href="http://wiki.sitemesh.org/display/sitemesh3/Getting+Started+with+SiteMesh+3">Sitemesh</a>
               or 
              <a href="http://tiles.apache.org/framework/tutorial/basic/pages.html">Tiles</a> for layout.
            </li>
            <li>
              <em>Velocity</em> or <em>Freemarker</em><br/> 
              Embedded templating languages, Spring integration comes with simple layout engine. 
            </li> 
            <li>
              <em>Your own</em><br/>
              Just write an implementation of <code><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/ViewResolver.html">ViewResolver</a></code>
            </li>
          </ul>
        </section>

				<section>
					<h2>An example controller</h2>
					<pre><code data-trim  contenteditable style="font-size: 80%">
@Controller @RequestMapping("/todos") public class CreateTodoController {
    @ModelAttribute("item")
    public TodoItem item() { return TodoItem.empty(); }
    
    @RequestMapping(value="/create", method = GET)
    public String showCreate() { return "/todo/create"; }
    
    @RequestMapping(value="/create", method = POST)
    public String createFromForm(@Valid @ModelAttribute("item") TodoItem item,
                                 BindingResult result) {
        if (result.hasErrors()) { 
            return showCreate();
        } else {
            todoService.save(item.withId());
            return "redirect:/todos";            
        }
}   }					
          </code></pre>
					
				</section>

				<section>
					<h2>Controller arguments (types)</h2>
          <ul>
            <li><a href="http://docs.spring.io/spring/docs/3.2.5.RELEASE/javadoc-api/org/springframework/web/util/UriComponentsBuilder.html"><code>UriComponentsBuilder</code></a> 
                - to build up <code>Location</code> headers</li>
            <li><code>InputStream</code>, <code>OutputStream</code> - to get access to request and response streams</li>
            <li><a href="http://docs.spring.io/spring/docs/3.2.5.RELEASE/javadoc-api/org/springframework/validation/BindingResult.html"><code>BindingResult</code></a>
             - Will contain any validation errors of <code>@Valid</code> arguments</li>
            <li>(annotated) <code>Object</code> - Model beans, url segments, ... 
          </ul>
				</section>

        <section>
          <h2>Controller arguments (annotations)</h2>
          <ul>
            <li><a href="http://docs.spring.io/spring/docs/3.2.x/javadoc-api/org/springframework/web/bind/annotation/ModelAttribute.html"><code>@ModelAttribute</code></a>
                - refer to scoped bean in model</li>
            <li><a href="http://docs.spring.io/spring/docs/3.2.x/javadoc-api/org/springframework/web/bind/annotation/PathVariable.html"><code>@PathVariable</code></a>
                - extract part of url into parameter</li>
            <li><a href="http://docs.spring.io/spring/docs/3.2.x/javadoc-api/org/springframework/web/bind/annotation/RequestBody.html"><code>@RequestBody</code></a> 
                - capture / unmarshal request</li>
            <li><a href="http://docs.oracle.com/javaee/6/api/javax/validation/Valid.html"><code>@Valid</code></a> - apply validations to bean</li>
          </ul>
        </section>
        
        <section>
          <h2>Return types for Controller methods</h2>
          <ul>
            <li><code>String</code> - Logical view name to render (resolved by <code><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/ViewResolver.html">ViewResolver</a></code>)</li>
            <li><a href="http://docs.spring.io/spring/docs/3.2.5.RELEASE/javadoc-api/org/springframework/web/portlet/ModelAndView.html"><code>ModelAndView</code></a> - Logical view to render, and a map of model beans</li>
            <li><code>void</code> - Custom output, e.g. by using <code>OutputStream</code> directly</li>
            <li><code><a href="">@ResponseBody</a> Object</code> - Marshal object as XML or JSON</li>
          </ul>
        </section>
        
        <section>
          <h2>Java-based configuration</h2>
          <ul>
            <li>Finally, a full web application without any XML files</li>
            <li>Building on Servlet 3.0, extend (yes, really)
                <a href="http://docs.spring.io/spring/docs/3.2.x/javadoc-api/org/springframework/web/servlet/support/AbstractAnnotationConfigDispatcherServletInitializer.html"><code>AbstractAnnotationConfigDispatcherServletInitializer</code></a>
                <br/>This replaces <code>web.xml</code>.</li>
            <li>Refer to one or more <a href=""><code>@Configuration</code></a> classes.<br/>
                This replaces <code>spring.xml</code> and <code>spring-servlet.xml</code>.</li>
          </ul>
        </section>

        <section>
          <h2>Java-based configuration</h2>
          <p>Advantages</p>
          <ul>
            <li>Compiler will verify type and property correctness early on</li>
            <li>Much more straightforward composition</li>
            <li>Can rely on existing Java tooling for</li>
            <ul>
              <li>Code completion</li>
              <li>Refactoring</li>
              <li>Unit testing</li>
            </ul>
          </ul>
        </section>

        <section>
          <h2>Internationalization and Localization</h2>
          <ul>
            <li>Have a <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/LocaleResolver.html"><code>LocaleResolver</code></a> bean which picks the request <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Locale.html"><code>Locale</code></a></li>
            <li>Have one or more <a href="http://docs.spring.io/spring/docs/3.2.5.RELEASE/javadoc-api/org/springframework/context/MessageSource.html"><code>MessageSource</code></a> beans with your translated texts</li>
            <li>Use the JSP tag library to render messages
            <pre><code>&lt;spring:message code="item.title" /&gt;</code></pre>
            </li>
            <li>Also available to the standard JSTL <code>fmt:</code> tag library (when using <a href="http://docs.spring.io/spring/docs/3.2.x/javadoc-api/org/springframework/web/servlet/view/JstlView.html"><code>JstlView</code></a>)</li>
          </ul>
        </section>

        <section>
          <h1>Let's look at some code</h1>
        </section>

        <section>
          <h2>Advantages</h2>
          <p><b>Spring MVC</b></p>
          <ul>
            <li>Gradual learning curve (until you reach the pixie dust magic)</li>
            <li>Broad access to support and internet forums</li>
            <li>Unified model for MVC and REST</li>
          </ul>
          <p style="margin-top: 1em;"><b>Server-side MVC in general</b></p>
          <ul>
            <li>Server-side handling: less browser quirks to deal with</li>
          </ul>
        </section>

        <section>
          <h2>Disadvantages</h2>
          <p><b>Spring MVC</b></p>
          <ul>
            <li>Big. <em>"It has become what it tried to replace."</em></li>
            <li>Annotation / AOP / Proxy magic (e.g. transactions)</li>
            <li>Choose between classpath scanning and XML hell</li>
          </ul>
          <p style="margin-top: 1em;"><b>Server-side MVC in general</b></p>
          <ul>
            <li>Statefulness provides challenges in scalability, deployability</li>
            <li>Still need to deal with concurrency</li>
            <li>Repetition due to redirect-after-post</li>
          </ul>
        </section>
        
        <section>
          <h2>A note about testing</h2>
          <ul>
            <li><em>Unit testing</em> - Keep units small (one class), use frameworks like <a href="http://code.google.com/p/mockito/">Mockito</a> </li>
            <li><em>Integration testing</em> - Keep units big (whole system), use frameworks like <a href="http://www.seleniumhq.org/projects/webdriver/">WebDriver</a> and embed <a href="http://www.eclipse.org/jetty/">Jetty</a></li>
            <li>Stay away from "half a system" integration tests, e.g. <a href="SpringJUnit4ClassRunner"><code>SpringJUnit4ClassRunner</code></a>
              or <a href="WebAppConfiguration"><code>@WebAppConfiguration</code></a>, even tough they're tempting.
            <ul>
              <li>My tests are green!</li>
              <li>...so what exactly did I just prove?</li>
            </ul> 
          </ul>
        </section>

        <section>
          <h3>Securing Spring MVC with Spring Security</h3>
          <ul>
            <li>Separate project, independent of Spring MVC</li>
            <li>Servlet filter protecting against e.g. <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF</a> or <a href="http://en.wikipedia.org/wiki/Session_fixation">Session Fixation</a>
            <li>Declarative security in several domains
              <ul>
                <li>URL patterns</li>
                <li>JSR-250 <a href="http://docs.oracle.com/javaee/5/api/javax/annotation/security/RolesAllowed.html"><code>@RolesAllowed</code></a> annotation (recommended)</li>
                <li>Custom Spring annotations</li>
              </ul> 
            <li>Java-based configuration from version 3.2</li>
            <li>JSP tag library for conditional display</li>
          </ul>
        </section>

        <section>
          <p>Thank you</p>

          <p style="margin-top: 4em">
            <small>Jan Ypma<br/>
            <a href="mailto:ypma@lundogbendsen.dk">
              ypma@lundogbendsen.dk
            </a></small>
          </p>
          
          <p style="margin-top: 2em; margin-right: 3em; text-align: right">
            <a href="http://www.lundogbendsen.dk">
              <img width="300" height="65" src="lb.png" alt="L&amp;B Logo"  style="background-color: white; border: 3px solid white; -webkit-transform: rotate(-10deg); -moz-transform: rotate(-10deg);"/>
            </a>
          </p>
        </section>
        
        <section>
          <h1>Spring MVC</h1>
          <h3>Advanced</h3>
          
          <p style="margin-top: 4em">
            <small>Jan Ypma<br/>
            <a href="mailto:ypma@lundogbendsen.dk">
              ypma@lundogbendsen.dk
            </a></small>
          </p>
          
          <p style="margin-top: 2em; margin-right: 3em; text-align: right">
            <a href="http://www.lundogbendsen.dk">
              <img width="300" height="65" src="lb.png" alt="L&amp;B Logo"  style="background-color: white; border: 3px solid white; -webkit-transform: rotate(-10deg); -moz-transform: rotate(-10deg);"/>
            </a>
          </p>
        </section>
        
        <section>
          <h2>Request lifecycle</h2>
          <p style="float:left; width: 40%;">
            <img src="http://yuml.me/diagram/scruffy;/activity/(start)-1 Request>(DispatcherServlet)->(Controller)-2 ModelAndView>(DispatcherServlet)->(ViewResolver)-3 View>(DispatcherServlet)->(View)->(DispatcherServlet)-4 Response>(end).svg"/>
          </p>
          <ol style="float: right; width: 50%;">
            <li>Request arrives, <a href="http://docs.spring.io/spring/docs/3.2.x/javadoc-api/org/springframework/web/servlet/DispatcherServlet.html">servlet</a> picks controller</li>
            <li><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/mvc/Controller.html">Controller</a> returns model and view name</li>
            <li><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/ViewResolver.html"><code>ViewResolver</code></a> instantiates view from name</li>
            <li><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/View.html"><code>View</code></a> renders actual response</li>
          </ol>
        </section>
                
        <section>
          <aside class="notes">
            Nothing to do with Hibernate itself
          </aside>
          <h2>Validation</h2>
          <p>Integration between Spring MVC and <a href="">Hibernate validator</a></p>
          <ul>
            <li>Declarative, recursive validation, e.g. <code>@Max(42)</code>, <code>@NotEmpty</code>, <code>@EMail</code>, ...</li>
            <li>Automatically invoked for <a href="http://docs.oracle.com/javaee/6/api/javax/validation/Valid.html"><code>@Valid</code></a> controller methods
              <ul>
                <li>and for service methods if using <a href="http://docs.spring.io/spring/docs/3.2.5.BUILD-SNAPSHOT/javadoc-api/org/springframework/validation/beanvalidation/MethodValidationPostProcessor.html"><code>MethodValidationPostProcessor</code></a>
              </ul>
            </li>
            <li>Integrated into Spring's messages and JSP tag library
              <pre><code>NotBlank.item.title = Todo item must have a title</code></pre>
              <pre><code>&lt;form:errors path="title" /&gt;</code></pre>
            </li>      
          </ul>
        </section>
        
        <section>
          <h2>Custom Validation</h2>
          <p>1. Define your validation annotation</p>
          <pre><code data-trim  contenteditable class="java">
@Target( { METHOD, FIELD } )
@Retention(RUNTIME)
@Constraint(validatedBy = ExistingItemIDValidator.class)
public @interface ExistingItemID {
    String message() default "{nl.ypmania.demo.ExistingItemID}";
    
    Class&lt;?&gt;[] groups() default {};
    
    Class&lt;? extends Payload&gt;[] payload() default {};
}          
          </code></pre>
        </section>
        
        <section>
          <h2>Custom Validation</h2>
          <p>2. Write the implementation</p>
          <pre><code data-trim  contenteditable class="java">
public class ExistingItemIDValidator 
       implements ConstraintValidator&lt;ExistingItemID, UUID&gt; {
    @Autowired
    private ItemService itemService;

    @Override
    public void initialize(ExistingItemID constraintAnnotation) { }

    @Override
    public boolean isValid(UUID id, ConstraintValidatorContext context) {
        return (id == null) ? true : itemService.exists(id);
    }
}          </code></pre>
        </section>
        
			</div>

		</div>

		<script src="reveal.js-2.6.0/lib/js/head.min.js"></script>
		<script src="reveal.js-2.6.0/js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				slideNumber: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'reveal.js-2.6.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'reveal.js-2.6.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js-2.6.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js-2.6.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'reveal.js-2.6.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'reveal.js-2.6.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
